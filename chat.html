<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>الشات</title>

  <link rel="stylesheet" href="style.css"/>
  <script src="config.js"></script>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

  <style>
    .composer-name{margin:8px 12px 4px;opacity:.75;font-weight:700;font-size:14px}
    .msgs{overflow-y:auto;-webkit-overflow-scrolling:touch}
    .msg{white-space:pre-wrap;word-break:break-word;overflow-wrap:anywhere}

    /* قائمة "افتح" المنسدلة */
    .menu-wrap{position:relative}
    .menu-btn{display:inline-flex;align-items:center;gap:8px}
    .dropdown{
      position:absolute; top:calc(100% + 8px); inset-inline-start:0; z-index:50;
      display:none; min-width:180px; background:#1b1c29; border:1px solid #2a2a3e;
      border-radius:12px; padding:8px; box-shadow:0 12px 30px rgba(0,0,0,.35)
    }
    .dropdown.open{display:block}
    .menu-item{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px; border-radius:10px; color:#e8e9f0; text-decoration:none
    }
    .menu-item:hover{background:#232638}
    .menu-sep{height:1px;background:#2a2a3e;margin:6px 0}
  </style>
</head>
<body class="chat-page">

  <!-- LTR عشان "يسار/يمين" تكون فعلية -->
  <div class="topbar" dir="ltr"
       style="display:grid;grid-template-columns:auto 1fr auto;align-items:center;width:100%;">
    <!-- أقصى اليسار: زر "افتح" يطلع منه القائمة -->
    <div class="menu-wrap" style="justify-self:start">
      <button id="menuToggle" class="btn ghost menu-btn" aria-expanded="false">
        افتح
        <svg width="14" height="14" viewBox="0 0 24 24"><path fill="#b9bfd3" d="M7 10l5 5 5-5z"/></svg>
      </button>
      <div id="dropdownMenu" class="dropdown" role="menu">
        <a id="menuOwner" href="owner.html" class="menu-item" style="display:none">
          <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#ffd166" d="M3 7l4 3 3-4 3 4 3-4 3 4 4-3v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7z"/></svg>
          لوحة التحكم
        </a>
        <div class="menu-sep"></div>
        <a id="menuExit" href="#" class="menu-item">
          <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#ff7a7a" d="M10 17l-1.41-1.41L12.17 12 8.59 8.41 10 7l5 5-5 5zM4 19h6v-2H6V7h4V5H4v14z"/></svg>
          خروج
        </a>
      </div>
    </div>

    <!-- المنتصف الآن بدون عنصر (المكان فاضي) -->

    <!-- أقصى اليمين: زر المايك لفتح/قفل الاستيج -->
    <button id="stageFab" aria-label="فتح/إقفال الاستيج"
            style="justify-self:end;position:static;width:36px;height:36px;border-radius:10px;display:inline-flex;align-items:center;justify-content:center">
      <svg viewBox="0 0 24 24" width="22" height="22">
        <path d="M12 14a3 3 0 003-3V6a3 3 0 10-6 0v5a3 3 0 003 3zm6-3a6 6 0 01-12 0H4a8 8 0 0016 0h-2zm-6 7a8.97 8.97 0 01-5-1.5v2a11 11 0 0010 0v-2A8.97 8.97 0 0112 18z"/>
      </svg>
    </button>
  </div>

  <div class="chat-wrap">
    <!-- الاستيج Overlay -->
    <div class="stage-panel open" id="stagePanel">
      <div class="stage">
        <div class="slots">
          <div class="slot" data-idx="0"><div class="mic"><svg viewBox="0 0 24 24"><path d="M12 14a3 3 0 003-3V6a3 3 0 10-6 0v5a3 3 0 003 3zm6-3a6 6 0 01-12 0H4a8 8 0 0016 0h-2zm-6 7a8.97 8.97 0 01-5-1.5v2a11 11 0 0010 0v-2A8.97 8.97 0 0112 18z"/></svg></div></div>
          <div class="slot" data-idx="1"><div class="mic"><svg viewBox="0 0 24 24"><path d="M12 14a3 3 0 003-3V6a3 3 0 10-6 0v5a3 3 0 003 3zm6-3a6 6 0 01-12 0H4a8 8 0 0016 0h-2zm-6 7a8.97 8.97 0 01-5-1.5v2a11 11 0 0010 0v-2A8.97 8.97 0 0112 18z"/></svg></div></div>
          <div class="slot" data-idx="2"><div class="mic"><svg viewBox="0 0 24 24"><path d="M12 14a3 3 0 003-3V6a3 3 0 10-6 0v5a3 3 0 003 3zm6-3a6 6 0 01-12 0H4a8 8 0 0016 0h-2zm-6 7a8.97 8.97 0 01-5-1.5v2a11 11 0 0010 0v-2A8.97 8.97 0 0112 18z"/></svg></div></div>
          <div class="slot" data-idx="3"><div class="mic"><svg viewBox="0 0 24 24"><path d="M12 14a3 3 0 003-3V6a3 3 0 10-6 0v5a3 3 0 003 3zm6-3a6 6 0 01-12 0H4a8 8 0 0016 0h-2zm-6 7a8.97 8.97 0 01-5-1.5v2a11 11 0 0010 0v-2A8.97 8.97 0 0112 18z"/></svg></div></div>
        </div>
      </div>
    </div>

    <!-- الرسائل -->
    <div class="main"><div class="msgs" id="msgs"></div></div>

    <div id="composerName" class="composer-name"></div>

    <div class="input-bar">
      <button id="emojiBtn" class="btn small" title="إيموجي" style="min-width:44px;padding:8px 0">🙂</button>
      <input class="input chat-input" id="text" placeholder="...اكتب رسالة"/>
      <button class="btn send" id="send">إرسال</button>
    </div>
  </div>

  <div id="emojiPanel" class="emoji-panel" dir="ltr"></div>

  <script src="chat.js"></script>
</body>
</html>
