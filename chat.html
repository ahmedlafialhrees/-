<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1"/>
<title>الروم</title>
<style>
  :root{
    --vh:1vh; --bg:#0b0f16; --panel:#0f1420; --line:#1d2840; --text:#e8ecf3; --muted:#98a0b3;
    --bubble:#121827; --bubbleMe:#0f1f38; --accent:#f5c84c; --accent2:#ffb300;
    --barH:56px; --radius:16px; --safeB:env(safe-area-inset-bottom,0px);
  }
  *{box-sizing:border-box} html,body{height:100%;margin:0}
  body{
    min-height:calc(var(--vh) * 100);
    background:radial-gradient(1200px 600px at 50% -10%, #1a2132 0%, #0b0f16 60%);
    color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    overscroll-behavior:contain;
  }

  .topbar{position:sticky;top:0;z-index:90;height:var(--barH);display:flex;align-items:center;justify-content:space-between;
    padding:8px 12px;border-bottom:1px solid var(--line);background:linear-gradient(180deg,#121a2a,#0f1420)}
  .left,.right{display:flex;align-items:center;gap:8px}
  .menu{position:relative}
  .iconBtn{width:44px;height:44px;border-radius:12px;border:0;cursor:pointer;color:#161616;font-weight:700;background:linear-gradient(135deg,#ffd86b,#ffb300)}

  /* القائمة الخاصة بميك يسار: تفتح يمين الزر */
  .dropdown{position:absolute;top:calc(100% + 8px);left:calc(100% + 8px);right:auto;
    min-width:180px;background:linear-gradient(180deg,#111827,#0e1420);border:1px solid var(--line);
    border-radius:12px;overflow:hidden;box-shadow:0 12px 36px rgba(0,0,0,.35)}
  .dropdown a{display:block;padding:10px 12px;text-decoration:none;color:var(--text);cursor:pointer}
  .dropdown a:hover{background:#121a2a}
  .hidden{display:none!important}

  .wrap{height:calc(var(--vh) * 100); display:flex; flex-direction:column}
  @supports(height:100dvh){ .wrap{ height:100dvh; } }
  .messages{flex:1;overflow:auto;padding:12px 12px calc(112px + var(--safeB));background:linear-gradient(180deg,#0f1420,#0b0f16)}
  .msg{background:var(--bubble);border:1px solid var(--line);border-radius:16px;padding:10px 12px;margin:10px 0;white-space:pre-wrap;word-break:break-word;overflow-wrap:anywhere}
  .msg.me{background:var(--bubbleMe);border-color:#203c6e}
  .meta{color:var(--muted);font-size:12px;margin-bottom:4px}

  .composer{position:fixed;left:0;right:0;bottom:0;z-index:100;background:linear-gradient(180deg,#0f1420,#0c111b);
    border-top:1px solid var(--line);padding:8px 10px calc(8px + var(--safeB))}
  .as{font-size:12px;color:var(--muted);margin-bottom:6px}
  .row{display:flex;gap:8px;align-items:center;position:relative}
  .row input[type="text"]{flex:1;padding:14px;border:1px solid var(--line);background:#0c1220;color:#e8ecf3;border-radius:14px;outline:none;font-size:16px}
  .sendBtn{padding:12px 14px;border:0;border-radius:12px;font-weight:700;cursor:pointer;color:#161616;background:linear-gradient(135deg,var(--accent),var(--accent2))}
  .emojiBtn{padding:12px;border-radius:12px;border:1px solid var(--line);background:#0c1220;color:#e8ecf3;cursor:pointer}
  .emojiPanel{position:absolute;bottom:58px;right:54px;background:#0f1420;border:1px solid var(--line);border-radius:12px;padding:8px;display:grid;grid-template-columns:repeat(8,28px);gap:6px;box-shadow:0 10px 24px rgba(0,0,0,.3);z-index:95}
  .emoji{cursor:pointer;font-size:20px;line-height:28px;text-align:center}

  /* Stage Overlay */
  .stageOverlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:120;backdrop-filter:blur(2px);background:rgba(0,0,0,.45)}
  .stage{width:min(520px,92%);background:linear-gradient(180deg,#111827,#0f1420);border:1px solid var(--line);border-radius:16px;padding:14px}
  .stage h3{margin:0 0 10px}
  .slots{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
  .slot{border:1px solid var(--line);background:#0e1420;border-radius:14px;padding:14px;text-align:center;cursor:pointer}
  .slot.me{border-color:#2e5cff; box-shadow:0 0 0 2px rgba(46,92,255,.15) inset}
  .slot.on{border-color:#f5c84c; box-shadow:0 0 0 2px rgba(245,200,76,.15) inset}
  .micCircle{width:64px;height:64px;border-radius:50%;display:grid;place-items:center;font-size:28px;margin:0 auto 8px;
             background:#0c1220;border:1px solid var(--line)}
  .slot.me .micCircle{border-color:#2e5cff}
  .slot.on .micCircle{border-color:#f5c84c}
  .name{font-size:12px;color:var(--muted)}
</style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <!-- ميك يسار + قائمته تفتح يمين -->
      <div class="left">
        <div class="menu">
          <button id="micLeftBtn" class="iconBtn" title="قائمة">🎤</button>
          <div id="menuDrop" class="dropdown hidden">
            <a id="ownerLink" class="hidden" href="owner.html">لوحة التحكم</a>
            <a id="logoutLink">خروج</a>
          </div>
        </div>
      </div>
      <!-- ميك يمين يفتح/يقفل الاستيج -->
      <div class="right">
        <button id="micRightBtn" class="iconBtn" title="الاستيج">🎤</button>
      </div>
    </div>

    <div id="messages" class="messages"></div>

    <div class="composer">
      <div id="asLine" class="as">ترسل كـ: -</div>
      <div class="row">
        <button id="emojiBtn" class="emojiBtn">🙂</button>
        <input id="msgInput" type="text" placeholder="اكتب رسالتك..."/>
        <button id="sendBtn" class="sendBtn">إرسال</button>
        <div id="emojiPanel" class="emojiPanel hidden" role="dialog" aria-label="الإيموجي">
          <div class="emoji">😀</div><div class="emoji">😁</div><div class="emoji">😂</div><div class="emoji">🤣</div>
          <div class="emoji">😊</div><div class="emoji">🥰</div><div class="emoji">😎</div><div class="emoji">🤔</div>
          <div class="emoji">🙃</div><div class="emoji">😴</div><div class="emoji">😡</div><div class="emoji">😭</div>
          <div class="emoji">👏</div><div class="emoji">👍</div><div class="emoji">🔥</div><div class="emoji">❤️</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Stage Overlay -->
  <div id="stageOverlay" class="stageOverlay" role="dialog" aria-label="الاستيج">
    <div class="stage">
      <h3>🎤 الاستيج</h3>
      <div id="slots" class="slots"></div>
      <!-- يفتح ويقفل بميك يمين فقط -->
    </div>
  </div>

  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script type="module" src="./chat.js?v=11"></script>
</body>
</html>
