<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ø§Ù„Ø±ÙˆÙ…</title>
<style>
  :root{
    --bg:#0b0f16; --panel:#0f1420; --line:#1d2840; --text:#e8ecf3; --muted:#98a0b3;
    --bubble:#121827; --bubbleMe:#0f1f38; --accent:#f5c84c; --accent2:#ffb300;
    --barH:56px; --radius:16px; --safeB:env(safe-area-inset-bottom,0px)
  }
  *{box-sizing:border-box} html,body{height:100%;margin:0}
  body{background:radial-gradient(1200px 600px at 50% -10%, #1a2132 0%, #0b0f16 60%);
       color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}

  /* Topbar */
  .topbar{position:sticky;top:0;z-index:90;height:var(--barH);display:flex;align-items:center;justify-content:space-between;
    padding:8px 12px;border-bottom:1px solid var(--line);background:linear-gradient(180deg,#121a2a,#0f1420)}
  .left,.right{display:flex;align-items:center;gap:8px}
  .title{font-weight:700}
  .openBtn{padding:10px 12px;border:0;border-radius:12px;cursor:pointer;color:#161616;font-weight:700;background:linear-gradient(135deg,var(--accent),var(--accent2))}

  /* Layout Ø«Ø§Ø¨Øª Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø© */
  .wrap{height:100dvh;display:flex;flex-direction:column}
  .messages{flex:1;overflow:auto;padding:12px 12px calc(112px + var(--safeB));background:linear-gradient(180deg,#0f1420,#0b0f16)}
  .msg{background:var(--bubble);border:1px solid var(--line);border-radius:16px;padding:10px 12px;margin:10px 0;white-space:pre-wrap;word-break:break-word;overflow-wrap:anywhere}
  .msg.me{background:var(--bubbleMe);border-color:#203c6e}
  .meta{color:var(--muted);font-size:12px;margin-bottom:4px}

  .composer{position:fixed;left:0;right:0;bottom:0;z-index:100;background:linear-gradient(180deg,#0f1420,#0c111b);
    border-top:1px solid var(--line);padding:8px 10px calc(8px + var(--safeB))}
  .as{font-size:12px;color:var(--muted);margin-bottom:6px}
  .row{display:flex;gap:8px;align-items:center;position:relative}
  .row input[type="text"]{flex:1;padding:12px;border:1px solid var(--line);background:#0c1220;color:var(--text);border-radius:14px;outline:none}
  .sendBtn{padding:12px 14px;border:0;border-radius:12px;font-weight:700;cursor:pointer;color:#161616;background:linear-gradient(135deg,var(--accent),var(--accent2))}
  .emojiBtn{padding:12px;border-radius:12px;border:1px solid var(--line);background:#0c1220;color:var(--text);cursor:pointer}
  .emojiPanel{position:absolute;bottom:58px;right:54px;background:#0f1420;border:1px solid var(--line);border-radius:12px;padding:8px;display:grid;grid-template-columns:repeat(8,28px);gap:6px;box-shadow:0 10px 24px rgba(0,0,0,.3);z-index:95}
  .emoji{cursor:pointer;font-size:20px;line-height:28px;text-align:center}
  .hidden{display:none!important}

  /* Bottom Sheet (Ø§ÙØªØ­) */
  .sheetBack{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:110;display:none}
  .sheet{position:fixed;left:0;right:0;bottom:0;z-index:120;transform:translateY(100%);transition:transform .28s ease;
         background:linear-gradient(180deg,#111827,#0f1420);border-top:1px solid var(--line);border-radius:18px 18px 0 0;padding:14px}
  .sheet.open{transform:translateY(0)}
  .sheetBack.show{display:block}
  .sheet h3{margin:0 0 10px}
  .sheet .row{margin-bottom:10px}
  .pill{display:inline-block;padding:6px 10px;border:1px solid var(--line);border-radius:999px;margin:4px 6px 0 0;font-size:12px}
  .xBtn{float:left;background:#151b2a;border:1px solid var(--line);color:#e8ecf3}
  .logoutBtn{background:#ffb300;color:#161616;font-weight:800}
</style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="left">
        <button id="openBtn" class="openBtn">Ø§ÙØªØ­</button>
      </div>
      <div class="title">Ø§Ù„Ø±ÙˆÙ… Ø§Ù„Ø¹Ø§Ù…</div>
      <div class="right"></div>
    </div>

    <div id="messages" class="messages"></div>

    <div class="composer">
      <div id="asLine" class="as">ØªØ±Ø³Ù„ ÙƒÙ€: -</div>
      <div class="row">
        <button id="emojiBtn" class="emojiBtn">ğŸ™‚</button>
        <input id="msgInput" type="text" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..."/>
        <button id="sendBtn" class="sendBtn">Ø¥Ø±Ø³Ø§Ù„</button>
        <div id="emojiPanel" class="emojiPanel hidden" role="dialog" aria-label="Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ">
          <div class="emoji">ğŸ˜€</div><div class="emoji">ğŸ˜</div><div class="emoji">ğŸ˜‚</div><div class="emoji">ğŸ¤£</div>
          <div class="emoji">ğŸ˜Š</div><div class="emoji">ğŸ¥°</div><div class="emoji">ğŸ˜</div><div class="emoji">ğŸ¤”</div>
          <div class="emoji">ğŸ™ƒ</div><div class="emoji">ğŸ˜´</div><div class="emoji">ğŸ˜¡</div><div class="emoji">ğŸ˜­</div>
          <div class="emoji">ğŸ‘</div><div class="emoji">ğŸ‘</div><div class="emoji">ğŸ”¥</div><div class="emoji">â¤ï¸</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Sheet -->
  <div id="sheetBack" class="sheetBack"></div>
  <div id="sheet" class="sheet" role="dialog" aria-label="Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª">
    <button id="closeSheet" class="xBtn">Ø¥ØºÙ„Ø§Ù‚</button>
    <h3>Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª</h3>

    <!-- ÙŠØ¸Ù‡Ø± Ù„Ù„Ø¬Ù…ÙŠØ¹ -->
    <div class="row">
      <button id="logoutBtn" class="sendBtn logoutBtn">Ø®Ø±ÙˆØ¬</button>
    </div>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ø£ÙˆÙ†Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ÙÙ‚Ø· -->
    <div id="ownerPanel" class="hidden">
      <h3>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (Ø£ÙˆÙ†Ø±)</h3>
      <div class="row">
        <input id="roleName" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" style="flex:2;padding:12px;border-radius:12px;border:1px solid var(--line);background:#0c1220;color:#e8ecf3"/>
        <select id="roleType" style="flex:1;padding:12px;border-radius:12px;border:1px solid var(--line);background:#0c1220;color:#e8ecf3">
          <option value="admin">Ø£Ø¯Ù…Ù†</option>
          <option value="owner">Ø£ÙˆÙ†Ø±</option>
        </select>
      </div>
      <div class="row">
        <input id="rolePass" type="text" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø®ØªØ§Ø±" style="flex:1;padding:12px;border-radius:12px;border:1px solid var(--line);background:#0c1220;color:#e8ecf3"/>
      </div>
      <div class="row">
        <button id="grantBtn" class="sendBtn">Ù…Ù†Ø­ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</button>
        <button id="revokeBtn" class="emojiBtn">Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</button>
        <button id="refreshRoles" class="emojiBtn">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
      </div>
      <div class="row">
        <div id="rolesList"></div>
      </div>
    </div>
  </div>

  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script type="module" src="./chat.js"></script>
</body>
</html>
